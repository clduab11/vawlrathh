name: Upload to HF Space

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  upload-to-hf:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: pip install --upgrade huggingface_hub

      - name: Upload to Hugging Face Space
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          python - <<'PY'
          import os
          import sys
          from huggingface_hub import HfApi

          token = os.environ.get("HF_TOKEN")
          if not token:
              sys.exit("HF_TOKEN secret is missing. Set it in the repository secrets before running this workflow.")

          api = HfApi()
          try:
              api.upload_folder(
                  folder_path=".",
                  repo_id="MCP-1st-Birthday/vawlrath",
                  repo_type="space",
                  token=token,
                  ignore_patterns=[
                      ".git/*",
                      ".github/*",
                      "*.pyc",
                      "__pycache__/*",
                      ".gitignore",
                      "hf-space/*",
                  ],
              )
          except Exception as err:
              sys.exit(f"Upload failed: {err}")
          else:
              print("Upload completed successfully.")
          PY
